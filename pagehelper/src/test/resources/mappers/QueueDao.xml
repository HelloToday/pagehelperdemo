<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bjs.demo.pagehelper.dao.QueueDao">
	<resultMap id="BaseResultMap"
		type="com.bjs.demo.pagehelper.model.QueueEntity">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="appid" property="appid" jdbcType="VARCHAR" />
		<result column="customerId" property="customerId" jdbcType="VARCHAR" />
		<result column="content" property="content" jdbcType="VARCHAR" />
		<result column="status" property="status" jdbcType="INTEGER" />
		<result column="system" property="system" jdbcType="INTEGER" />
		<result column="userId" property="userId" jdbcType="INTEGER" />
		<result column="createTime" property="createTime" jdbcType="VARCHAR" />
		<result column="updateTime" property="updateTime" jdbcType="VARCHAR" />
		<result column="title" property="title" jdbcType="VARCHAR" />
		<result column="tagId" property="tagId" jdbcType="INTEGER" />
		<result column="reminderId" property="reminderId" jdbcType="INTEGER" />
		<result column="locationType" property="locationType" jdbcType="INTEGER" />
		<result column="locationCode" property="locationCode" jdbcType="VARCHAR" />
		<result column="generalNoticeId" property="generalNoticeId" jdbcType="INTEGER" />
		<result column="iosJumpParam" property="iosJumpParam" jdbcType="VARCHAR" />
		<result column="androidJumpParam" property="androidJumpParam" jdbcType="VARCHAR" />
	</resultMap>
	<sql id="Base_Column_List">
		id, appid,customerId, content, status, system,userId, createTime, updateTime,title,tagId,reminderId,locationType,locationCode,generalNoticeId
	</sql>
	
	<select id="queryForPageForAgent" resultMap="BaseResultMap"
		parameterType="map">
		select 
		q.id id, 
		q.appid appid,
		q.customerId customerId, 
		q.content content, 
		q.status status, 
		q.system system,
		q.userId userId,
		q.createTime createTime, 
		q.updateTime updateTime,
		q.title title,
		q.tagId tagId,
		q.reminderId reminderId,
		q.locationType locationType,
		q.locationCode locationCode,
		q.generalNoticeId generalNoticeId,
		n.iosJumpParam iosJumpParam,
		n.androidJumpParam androidJumpParam
		from fso_push_queue q left join fso_general_notice n 
		on q.generalNoticeId = n.id
		where  q.isDelete=0
		<if test="userId != null">
			 and q.userId = #{userId,jdbcType=INTEGER}
		</if>
		<if test="status != null">
			and q.status = #{status,jdbcType=INTEGER}
		</if>
		<if test="customerId == null">
			and q.customerId is null
		</if>
		<if test="system != null and (4==system or 5==system)">
			and (q.system = #{system,jdbcType=INTEGER} or q.system=6)
		</if>
		<if test="system != null and !(4==system or 5==system)">
			and q.system = #{system,jdbcType=INTEGER}
		</if>
		<if test="tagId != null ">
			and q.tagId = #{tagId,jdbcType=INTEGER}
		</if>
		<if test="startTime != null and endTime != null ">
			and q.createTime <![CDATA[ >= ]]> #{startTime} and q.createTime <![CDATA[ <= ]]> #{endTime}
		</if>
		<if test="locationTypes != null ">
			and q.locationType in
			<foreach collection="locationTypes" index="index" item="locationType" open="(" close=")" separator=",">
				#{locationType}
			</foreach>
		</if>
		order by q.createTime desc
	</select>
	
</mapper>